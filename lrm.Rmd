---
title: "Logistic Regression Models"
output:
  html_document:
    toc: TRUE
    toc_float: TRUE
bibliography: refs.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

### Logistic regression with no predictors (intercept only)

100 Hershey's Kisses are put into a large cup and dumped on a table. We want to estimate the proportion of Kisses we can expect to land on their base. [@bilder2015] In our experiment we observe 39 out of 100. What is the 95% confidence interval on the proportion?

```{r}
prop.test(x = 39, n = 100)
```

To get just the confidence interval:

```{r}
pout <- prop.test(x = 39, n = 100)
pout$conf.int
```

This can be analyzed as an intercept-only binary logistic regression model. The confidence interval is slightly different.

```{r}
m <- glm(cbind(39, 100-39) ~ 1, family = binomial)
plogis(confint(m))
```

There are many confidence intervals that can be calculated for proportions. The binom package calculates 11 of them. [@binom]

```{r}
library(binom)
binom.confint(x = 39, n = 100)
```

The "prop.test" and "profile" versions are the two we calculated above. 

### Logistic regression with numeric predictors (1)

The `malaria` data frame from the ISwR package has 100 rows and 4 columns. It contains data on a sample of 100 children aged 3â€“15 years from a village in Ghana. Model the risk of malaria (`mal`) as a function of age (`age`) and log-transformed antibody levels (`log(ab)`). [@ISwR]

```{r}
library(ISwR)
data("malaria")
```

### Logistic regression with numeric predictors (2)

The `pima` data frame from the faraway package contains data on 768 adult female Pima Indians living near Phoenix [@faraway]. This data was collected by [The National Institute of Diabetes and Digestive and Kidney Diseases](https://www.niddk.nih.gov/). The purpose of the study was to investigate factors related to diabetes. The variable `test` indicates whether the patient showed signs of diabetes (coded 0 if negative, 1 if positive). Model `test` as a function of all other predictors.

```{r}
library(faraway)
data("pima")
```

What is the difference in odds of testing positive for diabetes for a subject with BMI in the first quartile compared to a subject with BMI at the third quartile? [@faraway_book]

```{r eval=FALSE}
library(emmeans)
bmi_vals <- quantile(pima$bmi, probs = c(0.25,0.75))
rg <- ref_grid(m, at = list(bmi = bmi_vals))
emmeans(rg, specs = "bmi", type = "response") |>
  contrast("pairwise")
```


### Ordered logistic regression

The `Vietnam` data frame in the vcdExtra package [@vcdextra] contains survey data from 1967 on student opinions of the Vietnam War. Students were asked to indicate which policy out of A, B, C or D they supported. The response categories were:

- A: Defeat North Vietnam by widespread bombing and land invasion
- B: Maintain the present policy
- C: De-escalate military activity, stop bombing and begin negotiations
- D: Withdraw military forces Immediately

These are ordered levels, moving from very pro-war (A) to anti-war (D). Fit a proportional odds model to the data, modeling `response` as a function of `sex`, `year`, and their interaction. [@friendly2016] (`year` is an integer ranging from 1 - 5, corresponding to Freshmen, Sophomore, Junior, Senior, and Grad student.) 

```{r}
library(vcdExtra)
data("Vietnam")
```

This will require using the `weights` argument with the `polr()` function. [@MASS]


### References
