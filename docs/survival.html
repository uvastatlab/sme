<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Survival Analysis</title>

<script src="site_libs/header-attrs-2.27/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistical Modeling Examples in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lm.html">linear models</a>
    </li>
    <li>
      <a href="lrm.html">logistic regression models</a>
    </li>
    <li>
      <a href="cm.html">count models</a>
    </li>
    <li>
      <a href="lme.html">mixed-effect models</a>
    </li>
    <li>
      <a href="survival.html">survival analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Survival Analysis</h1>

</div>


<div id="estimated-survival-functions" class="section level3">
<h3>Estimated Survival Functions</h3>
<p>In the textbook <em>Applied Survival Analysis, Second Edition</em>
<span class="citation">(David W. Hosmer 2008)</span>, the authors
explore data from the Worcester Heart Attack Study (WHAS). The goal of
the study was to investigate factors associated with survival following
myocardial infarction (heart attacks) among residents of Worcester,
Massachusetts. At the time of the book’s publication, the study had over
11,000 subjects. The authors explore a subset of just 100 subjects for
teaching purposes. In this section we replicate some of their
analyses.</p>
<p>We read in the data file, set admission date and follow-up date as a
Date class, and set gender as a factor.</p>
<pre class="r"><code>whas &lt;- read.table(&quot;data/whas100.dat&quot;)
names(whas) &lt;- c(&quot;id&quot;, &quot;admitdate&quot;, &quot;foldate&quot;, &quot;los&quot;, &quot;lenfol&quot;, &quot;fstat&quot;,
                 &quot;age&quot;, &quot;gender&quot;, &quot;bmi&quot;)
whas$admitdate &lt;- as.Date(whas$admitdate, format = &quot;%m/%d/%Y&quot;)
whas$foldate &lt;- as.Date(whas$foldate, format = &quot;%m/%d/%Y&quot;)
whas$gender &lt;- factor(whas$gender, labels = c(&quot;Male&quot;, &quot;Female&quot;))
head(whas, n = 10)</code></pre>
<pre><code>   id  admitdate    foldate los lenfol fstat age gender      bmi
1   1 1995-03-13 1995-03-19   4      6     1  65   Male 31.38134
2   2 1995-01-14 1996-01-23   5    374     1  88 Female 22.65790
3   3 1995-02-17 2001-10-04   5   2421     1  77   Male 27.87892
4   4 1995-04-07 1995-07-14   9     98     1  81 Female 21.47878
5   5 1995-02-09 1998-05-29   4   1205     1  78   Male 30.70601
6   6 1995-01-16 2000-09-11   7   2065     1  82 Female 26.45294
7   7 1995-01-17 1997-10-15   3   1002     1  66 Female 35.71147
8   8 1994-11-15 2000-11-24  56   2201     1  81 Female 28.27676
9   9 1995-08-18 1996-02-23   5    189     1  76   Male 27.12082
10 10 1995-07-22 2002-12-31   9   2719     0  40   Male 21.78971</code></pre>
<p>The “lenfol” variable is follow up time in days. This is how long
subjects were in the study. The “fstat” variable is vital status, where
dead = 1 and alive = 0. In the data above, subject 1 was in the study
for 6 days until they died. Subject 10 was in the study for 2,719 days
and was alive when they left the study. This latter subject is
“censored”, meaning they did not experience the event of interest.</p>
<p>A study that is analyzed using survival analysis typically has an
<em>observation period</em> during which subjects are enrolled and
observed, or it concerns a window of time where objects are observed.
When a subject or object is censored, that means they didn’t experience
the event <em>during</em> the observation period. It does not mean they
will never experience the event. A key assumption of survival analysis
is that the censoring is <em>uninformative</em> and not related to when
the subject will experience the event.</p>
<p>The <em>Kaplan-Meier (KM) curve</em> is the workhorse function for
visualizing and describing survival data over time. This method was
published by Edward Kaplan and Paul Meier in 1958. We can create a KM
curve using the <code>survfit()</code> function from the {survival}
package. To do this, we need to define survival time data using the
<code>Surv()</code> function. The first argument is survival time, the
second argument is the censoring indicator. Values with “+” appended are
censored values. These are subjects that were alive at the end of their
time in the study.</p>
<pre class="r"><code>library(survival)
Surv(whas$lenfol, whas$fstat)</code></pre>
<pre><code>  [1]    6   374  2421    98  1205  2065  1002  2201   189  2719+ 2638+  492 
 [13]  302  2574+ 2610+ 2641+ 1669  2624  2578+ 2595+  123  2613+  774  2012 
 [25] 2573+ 1874  2631+ 1907   538   104     6  1401  2710   841   148  2137+
 [37] 2190+ 2173+  461  2114+ 2157+ 2054+ 2124+ 2137+ 2031  2003+ 2074+  274 
 [49] 1984+ 1993+ 1939+ 1172    89   128  1939+   14  1011  1497  1929+ 2084+
 [61]  107   451  2183+ 1876+  936   363  1048  1889+ 2072+ 1879+ 1870+ 1859+
 [73] 2052+ 1846+ 2061+ 1912+ 1836+  114  1557  1278  1836+ 1916+ 1934+ 1923+
 [85]   44  1922+  274  1860+ 1806  2145+  182  2013+ 2174+ 1624   187  1883+
 [97] 1577    62  1969+ 1054 </code></pre>
<p>The <code>survfit()</code> function has <code>formula</code> and
<code>data</code> arguments, so we can directly use the variable names
in the <code>Surv()</code> function. The <code>~ 1</code> says we want
to fit a single survival curve for the entire data set. Calling
<code>plot()</code> on the fitted object produces an estimate of a
survival function for the data.</p>
<pre class="r"><code>fit &lt;- survfit(Surv(lenfol, fstat) ~ 1, data = whas)
plot(fit, xlab = &quot;Survial Time (days)&quot;, 
     ylab = &quot;Estimated Survival Probability&quot;,
     mark.time = TRUE)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Starting at the far left of the plot, we estimate a probability of 1
that subjects survive to day 0. By day 500, the probability of survival
drops to about 0.75. The dashed lines around the solid line are 95%
confidence limits. We estimate the probability of survival to day 500 to
be about [0.68, 0.85] with 95% confidence. The little markers represent
censored observations. These can be suprressed by setting
<code>mark.time = FALSE</code>.</p>
<p>We can call <code>summary()</code> on the fitted object to get
specific predicted probabilities. For example, we can look at days 0,
500, 1000 and 1500. It appears subjects have about [0.54, 0.73]
probability to survive to 1500 days after a heart attack.</p>
<pre class="r"><code>summary(fit, times = c(0,500,1000,1500))</code></pre>
<pre><code>Call: survfit(formula = Surv(lenfol, fstat) ~ 1, data = whas)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    0    100       0     1.00  0.0000        1.000        1.000
  500     76      24     0.76  0.0427        0.681        0.848
 1000     72       4     0.72  0.0449        0.637        0.814
 1500     63       9     0.63  0.0483        0.542        0.732</code></pre>
<p>With such long periods of time, it may be more natural to consider
years instead of days. We can either convert days to years in our data
and re-fit the model, or we can use the <code>xscale</code> and
<code>scale</code> arguments in <code>plot()</code> and
<code>summary()</code>, respectively. Let’s try the latter approach
where we set the arguments to 365.25 (i.e., the number of days in a
year).</p>
<pre class="r"><code>plot(fit, xlab = &quot;Survial Time (years)&quot;, 
     ylab = &quot;Estimated Survival Probability&quot;, 
     xscale = 365.25, mark.time = TRUE)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>To get predicted probabilities for years 0 through 6, we need to set
<code>scale = 365.25</code> and multiply the times of interest by
365.25.</p>
<pre class="r"><code>summary(fit, times = 365.25* c(0:6), scale = 365.25)</code></pre>
<pre><code>Call: survfit(formula = Surv(lenfol, fstat) ~ 1, data = whas)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    0    100       0    1.000  0.0000        1.000        1.000
    1     80      20    0.800  0.0400        0.725        0.882
    2     75       5    0.750  0.0433        0.670        0.840
    3     68       7    0.680  0.0466        0.594        0.778
    4     64       4    0.640  0.0480        0.553        0.741
    5     58       6    0.580  0.0494        0.491        0.685
    6     14       5    0.505  0.0537        0.410        0.622</code></pre>
<p>How does survival differ between men and women? We can estimate a
survival function for each group and create a plot as follows:</p>
<pre class="r"><code>fit2 &lt;- survfit(Surv(lenfol, fstat) ~ gender, data = whas)
plot(fit2, xlab = &quot;Survial Time (days)&quot;, 
     ylab = &quot;Estimated Survival Probability&quot;, col = 1:2,
     mark.time = TRUE)
legend(&quot;topright&quot;, col = 1:2, lty = 1, legend = c(&quot;Male&quot;, &quot;Female&quot;))</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The {survminer} package makes creating such a plot a little easier.
Simply call the <code>ggsurvplot()</code> function on the fitted object.
Setting <code>conf.int = TRUE</code> adds a confidence ribbon for each
group.</p>
<pre class="r"><code>library(survminer)
ggsurvplot(fit2, conf.int = TRUE)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>It appears males have an expected higher probability of survival
following a heart attack, though the overlapping confidence bands
suggest some uncertainty in this observation. We can formally test for a
difference in the survival functions using the log-rank test, which is
available via the <code>survdiff()</code> function.</p>
<pre class="r"><code>survdiff(Surv(lenfol, fstat) ~ gender, data = whas)</code></pre>
<pre><code>Call:
survdiff(formula = Surv(lenfol, fstat) ~ gender, data = whas)

               N Observed Expected (O-E)^2/E (O-E)^2/V
gender=Male   65       28     34.6      1.27      3.97
gender=Female 35       23     16.4      2.68      3.97

 Chisq= 4  on 1 degrees of freedom, p= 0.05 </code></pre>
<p>The null hypothesis of this test is no difference in the estimated
survival functions. Small p-values provide evidence against this
hypothesis. With p = 0.05, it seems this difference in survival between
males and females could be real. However, as we see in the plot, the
confidence bands overlap throughout the range of the data. Calling
<code>summary()</code> on the model object for years 1 - 5 shows an
overlap in 95% confidence intervals at every year.</p>
<pre class="r"><code>summary(fit2, times = 365.25* c(1:5), scale = 365.25)</code></pre>
<pre><code>Call: survfit(formula = Surv(lenfol, fstat) ~ gender, data = whas)

                gender=Male 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1     55      10    0.846  0.0448        0.763        0.939
    2     52       3    0.800  0.0496        0.708        0.903
    3     48       4    0.738  0.0545        0.639        0.853
    4     45       3    0.692  0.0572        0.589        0.814
    5     41       4    0.631  0.0599        0.524        0.760

                gender=Female 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1     25      10    0.714  0.0764        0.579        0.881
    2     23       2    0.657  0.0802        0.517        0.835
    3     20       3    0.571  0.0836        0.429        0.761
    4     19       1    0.543  0.0842        0.401        0.736
    5     17       2    0.486  0.0845        0.345        0.683</code></pre>
<p>Clearly we should be cautious before stating with certainty that men
survive longer than women after heart attacks.</p>
</div>
<div id="cox-proportional-hazards-model" class="section level3">
<h3>Cox Proportional Hazards Model</h3>
<p>To do.</p>
<div id="refs" class="references csl-bib-body hanging-indent"
entry-spacing="0">
<div id="ref-hosmer2008" class="csl-entry">
David W. Hosmer, Susanne May, Stanley Lemeshow. 2008. <em>Applied
Survival Analysis: Regression Modeling of Time to Event Data: Second
Edition</em>. John Wiley; Sons Inc.
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
