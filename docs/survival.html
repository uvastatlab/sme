<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Survival Analysis</title>

<script src="site_libs/header-attrs-2.27/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Statistical Modeling Examples in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lm.html">linear models</a>
    </li>
    <li>
      <a href="lrm.html">logistic regression models</a>
    </li>
    <li>
      <a href="cm.html">count models</a>
    </li>
    <li>
      <a href="lme.html">mixed-effect models</a>
    </li>
    <li>
      <a href="survival.html">survival analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Survival Analysis</h1>

</div>


<div id="estimated-survival-functions" class="section level3">
<h3>Estimated Survival Functions</h3>
<p>In the textbook <em>Applied Survival Analysis, Second Edition</em>
<span class="citation">(David W. Hosmer 2008)</span>, the authors
explore data from the Worcester Heart Attack Study (WHAS). The goal of
the study was to investigate factors associated with survival following
myocardial infarction (heart attacks) among residents of Worcester,
Massachusetts. At the time of the book’s publication, the study had over
11,000 subjects. The authors explore a subset of just 100 subjects for
teaching purposes. In this section we replicate some of their
analyses.</p>
<p>We read in the data file, set admission date and follow-up date as a
Date class, and set gender as a factor.</p>
<pre class="r"><code>whas &lt;- read.table(&quot;data/whas100.dat&quot;)
names(whas) &lt;- c(&quot;id&quot;, &quot;admitdate&quot;, &quot;foldate&quot;, &quot;los&quot;, &quot;lenfol&quot;, &quot;fstat&quot;,
                 &quot;age&quot;, &quot;gender&quot;, &quot;bmi&quot;)
whas$admitdate &lt;- as.Date(whas$admitdate, format = &quot;%m/%d/%Y&quot;)
whas$foldate &lt;- as.Date(whas$foldate, format = &quot;%m/%d/%Y&quot;)
whas$gender &lt;- factor(whas$gender, labels = c(&quot;Male&quot;, &quot;Female&quot;))
head(whas, n = 10)</code></pre>
<pre><code>   id  admitdate    foldate los lenfol fstat age gender      bmi
1   1 1995-03-13 1995-03-19   4      6     1  65   Male 31.38134
2   2 1995-01-14 1996-01-23   5    374     1  88 Female 22.65790
3   3 1995-02-17 2001-10-04   5   2421     1  77   Male 27.87892
4   4 1995-04-07 1995-07-14   9     98     1  81 Female 21.47878
5   5 1995-02-09 1998-05-29   4   1205     1  78   Male 30.70601
6   6 1995-01-16 2000-09-11   7   2065     1  82 Female 26.45294
7   7 1995-01-17 1997-10-15   3   1002     1  66 Female 35.71147
8   8 1994-11-15 2000-11-24  56   2201     1  81 Female 28.27676
9   9 1995-08-18 1996-02-23   5    189     1  76   Male 27.12082
10 10 1995-07-22 2002-12-31   9   2719     0  40   Male 21.78971</code></pre>
<p>The “lenfol” variable is follow up time in days. This is how long
subjects were in the study. The “fstat” variable is vital status, where
dead = 1 and alive = 0. In the data above, subject 1 was in the study
for 6 days until they died. Subject 10 was in the study for 2,719 days
and was alive when they left the study. This latter subject is
“censored”, meaning they did not experience the event of interest.</p>
<p>A study that is analyzed using survival analysis typically has an
<em>observation period</em> during which subjects are enrolled and
observed, or it concerns a window of time where objects are observed.
When a subject or object is censored, that means they didn’t experience
the event <em>during</em> the observation period. It does not mean they
will never experience the event. A key assumption of survival analysis
is that the censoring is <em>uninformative</em> and not related to when
the subject will experience the event.</p>
<p>The <em>Kaplan-Meier (KM) curve</em> is the workhorse function for
visualizing and describing survival data over time. This method was
published by Edward Kaplan and Paul Meier in 1958. We can create a KM
curve using the <code>survfit()</code> function from the {survival}
package <span class="citation">(Therneau 2024)</span>. To do this, we
need to define survival time data using the <code>Surv()</code>
function. The first argument is survival time, the second argument is
the censoring indicator. Values with “+” appended are censored values.
These are subjects that were alive at the end of their time in the
study.</p>
<pre class="r"><code>library(survival)
Surv(whas$lenfol, whas$fstat)</code></pre>
<pre><code>  [1]    6   374  2421    98  1205  2065  1002  2201   189  2719+ 2638+  492 
 [13]  302  2574+ 2610+ 2641+ 1669  2624  2578+ 2595+  123  2613+  774  2012 
 [25] 2573+ 1874  2631+ 1907   538   104     6  1401  2710   841   148  2137+
 [37] 2190+ 2173+  461  2114+ 2157+ 2054+ 2124+ 2137+ 2031  2003+ 2074+  274 
 [49] 1984+ 1993+ 1939+ 1172    89   128  1939+   14  1011  1497  1929+ 2084+
 [61]  107   451  2183+ 1876+  936   363  1048  1889+ 2072+ 1879+ 1870+ 1859+
 [73] 2052+ 1846+ 2061+ 1912+ 1836+  114  1557  1278  1836+ 1916+ 1934+ 1923+
 [85]   44  1922+  274  1860+ 1806  2145+  182  2013+ 2174+ 1624   187  1883+
 [97] 1577    62  1969+ 1054 </code></pre>
<p>The <code>survfit()</code> function has <code>formula</code> and
<code>data</code> arguments, so we can directly use the variable names
in the <code>Surv()</code> function. The <code>~ 1</code> says we want
to fit a single survival curve for the entire data set. Calling
<code>plot()</code> on the fitted object produces an estimate of a
survival function for the data.</p>
<pre class="r"><code>fit &lt;- survfit(Surv(lenfol, fstat) ~ 1, data = whas)
plot(fit, xlab = &quot;Survial Time (days)&quot;, 
     ylab = &quot;Estimated Survival Probability&quot;,
     mark.time = TRUE)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Starting at the far left of the plot, we estimate a probability of 1
that subjects survive to day 0. By day 500, the probability of survival
drops to about 0.75. The dashed lines around the solid line are 95%
confidence limits. We estimate the probability of survival to day 500 to
be about [0.68, 0.85] with 95% confidence. The little markers represent
censored observations. These can be suprressed by setting
<code>mark.time = FALSE</code>.</p>
<p>We can call <code>summary()</code> on the fitted object to get
specific predicted probabilities. For example, we can look at days 0,
500, 1000 and 1500. It appears subjects have about [0.54, 0.73]
probability to survive to 1500 days after a heart attack.</p>
<pre class="r"><code>summary(fit, times = c(0,500,1000,1500))</code></pre>
<pre><code>Call: survfit(formula = Surv(lenfol, fstat) ~ 1, data = whas)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    0    100       0     1.00  0.0000        1.000        1.000
  500     76      24     0.76  0.0427        0.681        0.848
 1000     72       4     0.72  0.0449        0.637        0.814
 1500     63       9     0.63  0.0483        0.542        0.732</code></pre>
<p>With such long periods of time, it may be more natural to consider
years instead of days. We can either convert days to years in our data
and re-fit the model, or we can use the <code>xscale</code> and
<code>scale</code> arguments in <code>plot()</code> and
<code>summary()</code>, respectively. Let’s try the latter approach
where we set the arguments to 365.25 (i.e., the number of days in a
year).</p>
<pre class="r"><code>plot(fit, xlab = &quot;Survial Time (years)&quot;, 
     ylab = &quot;Estimated Survival Probability&quot;, 
     xscale = 365.25, mark.time = TRUE)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>To get predicted probabilities for years 0 through 6, we need to set
<code>scale = 365.25</code> and multiply the times of interest by
365.25.</p>
<pre class="r"><code>summary(fit, times = 365.25* c(0:6), scale = 365.25)</code></pre>
<pre><code>Call: survfit(formula = Surv(lenfol, fstat) ~ 1, data = whas)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    0    100       0    1.000  0.0000        1.000        1.000
    1     80      20    0.800  0.0400        0.725        0.882
    2     75       5    0.750  0.0433        0.670        0.840
    3     68       7    0.680  0.0466        0.594        0.778
    4     64       4    0.640  0.0480        0.553        0.741
    5     58       6    0.580  0.0494        0.491        0.685
    6     14       5    0.505  0.0537        0.410        0.622</code></pre>
<p>How does survival differ between men and women? We can estimate a
survival function for each group and create a plot as follows:</p>
<pre class="r"><code>fit2 &lt;- survfit(Surv(lenfol, fstat) ~ gender, data = whas)
plot(fit2, xlab = &quot;Survial Time (days)&quot;, 
     ylab = &quot;Estimated Survival Probability&quot;, col = 1:2,
     mark.time = TRUE)
legend(&quot;topright&quot;, col = 1:2, lty = 1, legend = c(&quot;Male&quot;, &quot;Female&quot;))</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The {survminer} package makes creating such a plot a little easier
<span class="citation">(Kassambara, Kosinski, and Biecek 2021)</span>.
Simply call the <code>ggsurvplot()</code> function on the fitted object.
Setting <code>conf.int = TRUE</code> adds a confidence ribbon for each
group.</p>
<pre class="r"><code>library(survminer)
ggsurvplot(fit2, conf.int = TRUE)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>It appears males have an expected higher probability of survival
following a heart attack, though the overlapping confidence bands
suggest some uncertainty in this observation. We can formally test for a
difference in the survival functions using the log-rank test, which is
available via the <code>survdiff()</code> function.</p>
<pre class="r"><code>survdiff(Surv(lenfol, fstat) ~ gender, data = whas)</code></pre>
<pre><code>Call:
survdiff(formula = Surv(lenfol, fstat) ~ gender, data = whas)

               N Observed Expected (O-E)^2/E (O-E)^2/V
gender=Male   65       28     34.6      1.27      3.97
gender=Female 35       23     16.4      2.68      3.97

 Chisq= 4  on 1 degrees of freedom, p= 0.05 </code></pre>
<p>The null hypothesis of this test is no difference in the estimated
survival functions. Small p-values provide evidence against this
hypothesis. With p = 0.05, it seems this difference in survival between
males and females could be real. However, as we see in the plot, the
confidence bands overlap throughout the range of the data. Calling
<code>summary()</code> on the model object for years 1 - 5 shows an
overlap in 95% confidence intervals at every year.</p>
<pre class="r"><code>summary(fit2, times = 365.25* c(1:5), scale = 365.25)</code></pre>
<pre><code>Call: survfit(formula = Surv(lenfol, fstat) ~ gender, data = whas)

                gender=Male 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1     55      10    0.846  0.0448        0.763        0.939
    2     52       3    0.800  0.0496        0.708        0.903
    3     48       4    0.738  0.0545        0.639        0.853
    4     45       3    0.692  0.0572        0.589        0.814
    5     41       4    0.631  0.0599        0.524        0.760

                gender=Female 
 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1     25      10    0.714  0.0764        0.579        0.881
    2     23       2    0.657  0.0802        0.517        0.835
    3     20       3    0.571  0.0836        0.429        0.761
    4     19       1    0.543  0.0842        0.401        0.736
    5     17       2    0.486  0.0845        0.345        0.683</code></pre>
<p>Clearly we should be cautious before stating with certainty that men
survive longer than women after heart attacks.</p>
</div>
<div id="cox-proportional-hazards-model" class="section level3">
<h3>Cox Proportional Hazards Model</h3>
<p>The text <em>Survival Analysis</em> <span class="citation">(David G.
Kleinbaum 2005)</span> presents a study that followed 42 leukemia
patients in remission. The patients were randomly assigned to
maintenance therapy with either “6-MP” (a new treatment) or placebo. 21
subjects were assigned to each group. The event of interest was “coming
out of remission.” <span class="citation">(B et al. 1963)</span></p>
<p>Below we load the data and look at the first five rows.</p>
<pre class="r"><code>d &lt;- readRDS(&quot;data/leuk.rds&quot;)
head(d)</code></pre>
<pre><code>  survt status sex logwbc  rx
1    35      0   1   1.45 trt
2    34      0   1   1.47 trt
3    32      0   1   2.20 trt
4    32      0   1   2.53 trt
5    25      0   1   1.78 trt
6    23      1   1   2.57 trt</code></pre>
<p>Variables definitions:</p>
<ul>
<li>survt (time in weeks; time until coming out of remission)</li>
<li>status (0 = censored, 1 = came out of remission)</li>
<li>sex (0 = female, 1 = male)</li>
<li>logwbc (log transformed white blood cell count)</li>
<li>rx (treatment or placebo)</li>
</ul>
<p>The rx variable has two levels, “trt” and “placebo”. Notice below
that the “trt” level is the reference, or baseline, level.</p>
<pre class="r"><code>levels(d$rx)</code></pre>
<pre><code>[1] &quot;trt&quot;     &quot;placebo&quot;</code></pre>
<p>Some questions of interest:</p>
<ul>
<li>Does the 6-MP treatment increase time until “failure”?</li>
<li>Do we need to control for log WBC?</li>
<li>Is the treatment effect the same for males and females?</li>
</ul>
<p>To answer these questions we’ll use Cox Proportional Hazards (PH)
Modeling.</p>
<p>The {survival} package provides the <code>coxph()</code> function for
fitting Cox PH models. We use the function as we would <code>lm()</code>
or <code>glm()</code>, but with the left-hand side requiring the use of
the <code>Surv()</code> function.</p>
<p>Below we model time-to-remission as a function of rx and save as
<code>m1</code> and then use <code>summary()</code> to request the model
summary.</p>
<pre class="r"><code>library(survival)
m1 &lt;- coxph(Surv(survt, status) ~ rx, data = d)
summary(m1)</code></pre>
<pre><code>Call:
coxph(formula = Surv(survt, status) ~ rx, data = d)

  n= 42, number of events= 30 

            coef exp(coef) se(coef)     z Pr(&gt;|z|)    
rxplacebo 1.5721    4.8169   0.4124 3.812 0.000138 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

          exp(coef) exp(-coef) lower .95 upper .95
rxplacebo     4.817     0.2076     2.147     10.81

Concordance= 0.69  (se = 0.041 )
Likelihood ratio test= 16.35  on 1 df,   p=5e-05
Wald test            = 14.53  on 1 df,   p=1e-04
Score (logrank) test = 17.25  on 1 df,   p=3e-05</code></pre>
<p>The coefficient we’re usually most interested in is the one labeled
“exp(coef)”. This is the <em>hazard ratio</em>. The interpretation above
is that the hazard of failure for those on “placebo” is about 4.8 times
higher than the hazard of failure for those on “treatment”. The next
section shows a 95% confidence interval on the hazard ratio. The hazard
of failure for those on placebo is plausibly anywhere from 2 to 10 times
higher than the hazard of failure for the trt group.</p>
<p>The statistic labeled “Concordance” reports the fraction of all pairs
of subjects where the model correctly predicts the individual with the
earlier event. Values in the 0.50 - 0.55 range suggest a flip of a coin
would do as well as our model at correctly ordering pairs of subjects.
The value of 0.69 (+/- 0.04) is promising but not excellent.</p>
<p>The three tests at the end test the null that all model coefficients
are simultaneously equal to 0. These are usually all in agreement. When
these disagree, go with the Likelihood Ratio Test (Hosmer et al,
p. 79)</p>
<p>We can use our Cox PH model to create <em>covariate_adjusted survival
curves</em>. To do so, we need to first use the <code>survfit()</code>
function on the model object. Notice we need to set the covariate values
to create the curves. Below we specify we want a curve for each level of
rx.</p>
<pre class="r"><code>sfit1 &lt;- survfit(m1, newdata = data.frame(rx = c(&quot;trt&quot;, &quot;placebo&quot;)))</code></pre>
<p>Now we’re ready to make the plot using the <code>ggsurvplot()</code>
from the {survminer} package <span class="citation">(Kassambara,
Kosinski, and Biecek 2021)</span>.</p>
<pre class="r"><code>library(survminer)
ggsurvplot(sfit1, data = d)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Notice this plot assumes proportional hazards and uses all the data.
Compare to the Kaplan-Meier curve below, which only uses the data in
each treatment group and does not assume proportional hazards. Recall
the KM curve is non-parametric and descriptive.</p>
<pre class="r"><code>fit2 &lt;- survfit(Surv(survt, status) ~ rx, data = d)
ggsurvplot(fit2)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>As before we can use the <code>summary()</code> method on the survfit
object to see the specific survival probabilities at specific times. The
“survival1” column refers to level “trt” and the “survival2” column
refers to level “placebo”. The probability of staying remission for the
trt group is much higher (0.633) than the placebo group (0.110).</p>
<pre class="r"><code>summary(sfit1, times = c(5,10,15,20))</code></pre>
<pre><code>Call: survfit(formula = m1, newdata = data.frame(rx = c(&quot;trt&quot;, &quot;placebo&quot;)))

 time n.risk n.event survival1 survival2
    5     35       9     0.915     0.652
   10     23       9     0.803     0.347
   15     15       6     0.685     0.162
   20     10       2     0.633     0.110</code></pre>
<p>The Cox PH model assumes that the <em>hazard ratio is constant over
time</em>. The model for the leukemia data above implies the hazard of
failure on placebo is about 4.8 times higher than the hazard of failure
on treatment, no matter how long we observe the subjects. Notice the
summary output above makes no reference to time.</p>
<p>Fortunately the {survival} package makes it easy to assess these
assumptions using the <code>cox.zph()</code> function. Use it on your
model object. The null hypothesis is the hazard ratios are independent
of time. A small p-value is evidence against the null hypothesis. The
proportional hazard assumption is probably safe if the p-value is higher
than, say, 0.05.</p>
<pre class="r"><code>cox.zph(m1)</code></pre>
<pre><code>        chisq df    p
rx     0.0229  1 0.88
GLOBAL 0.0229  1 0.88</code></pre>
<p>Each variable is tested. The GLOBAL test is that all variables
<em>simultaneously</em> satisfy the proportional hazards assumption. In
this case they’re the same since we only have one predictor. Set
<code>global=FALSE</code> to suppress the global test.</p>
<p>A visual check of the proportional hazards assumption is available
using the <code>plot()</code> method. A smooth trend line is plotted
through residuals versus time. A fairly straight line indicates the
proportional hazards assumption is likely satisfied. The dashed lines
are +/- two standard error confidence bands for the smooth line. We
would like to be able to draw a straight line through the middle of the
confidence bands. This implies the model predictions, which are relative
hazards, are staying consistent over time.</p>
<pre class="r"><code>plot(cox.zph(m1))</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The <code>ggcoxzph()</code> function from the {survminer} package
makes a slightly fancier plot that includes the result of the hypothesis
test.</p>
<pre class="r"><code>ggcoxzph(cox.zph(m1))</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>In our previous model we only looked at the effect of “rx” on time to
failure. We may also want to adjust for white blood cell count
(“logwbc”). This is a known prognostic indicator of coming out of
remission for leukemia patients. Indeed we can see an association
between “survt” (time-to-failure) and “logwbc”, for those subjects who
experienced the event (status = 1).</p>
<pre class="r"><code>plot(survt ~ logwbc, data = d, subset = status == 1)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Below we add the variable “logwbc” (log-transformed white blood cell
count) to the model. This allows us to estimate placebo and treatment
effects on patients with similar white blood cell counts.</p>
<pre class="r"><code>m2 &lt;- coxph(Surv(survt, status) ~ rx + logwbc, data = d)
summary(m2)</code></pre>
<pre><code>Call:
coxph(formula = Surv(survt, status) ~ rx + logwbc, data = d)

  n= 42, number of events= 30 

            coef exp(coef) se(coef)     z Pr(&gt;|z|)    
rxplacebo 1.3861    3.9991   0.4248 3.263   0.0011 ** 
logwbc    1.6909    5.4243   0.3359 5.034  4.8e-07 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

          exp(coef) exp(-coef) lower .95 upper .95
rxplacebo     3.999     0.2501     1.739     9.195
logwbc        5.424     0.1844     2.808    10.478

Concordance= 0.852  (se = 0.04 )
Likelihood ratio test= 46.71  on 2 df,   p=7e-11
Wald test            = 33.6  on 2 df,   p=5e-08
Score (logrank) test = 46.07  on 2 df,   p=1e-10</code></pre>
<p>Adjusted for white blood cell count, it appears the hazard of failure
for subjects on placebo is about 4 times higher than the hazard of
failure for subjects on treatment. Likewise, adjusted for rx, the hazard
of failure increases by about a factor of 5 for each one unit increase
in logwbc. (In this case, that’s probably not an interpretation we’re
interested in. We simply want to adjust for subjects’ white blood cell
count.)</p>
<p>Adjusting for logwbc reduces the effect of rx about 12%. This is a
sign that logwbc may be <em>confounded</em> with rx, and that we should
include it in our model.</p>
<pre class="r"><code>coef(m2)[1]/coef(m1)[1]</code></pre>
<pre><code>rxplacebo 
0.8816572 </code></pre>
<p>The confidence interval on the rx hazard ratio is also tighter (more
precise) in the model with logwbc.</p>
<p>Model 1 without logwbc CI width (upper bound - lower bound):<br />
10.81 - 2.147 = 8.663</p>
<p>Model 2 with logwbc CI width (upper bound - lower bound):<br />
9.195 - 1.739 = 7.456</p>
<p>We can formally compare models using the <code>anova()</code>
function. The null hypothesis of this test is that the models are
equally adequate. The test below suggests we should keep logwbc in our
model.</p>
<pre class="r"><code>anova(m1, m2)</code></pre>
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(survt, status)
 Model 1: ~ rx
 Model 2: ~ rx + logwbc
   loglik  Chisq Df Pr(&gt;|Chi|)    
1 -85.008                         
2 -69.828 30.361  1  3.587e-08 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We should assess the proportional hazards assumption again. Recall
this assumption applies to all predictors in the model.</p>
<pre class="r"><code>cox.zph(m2)</code></pre>
<pre><code>          chisq df    p
rx     8.27e-05  1 0.99
logwbc 4.00e-02  1 0.84
GLOBAL 4.02e-02  2 0.98</code></pre>
<pre class="r"><code>plot(cox.zph(m2))</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-26-1.png" width="672" /><img src="survival_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<p>Or using <code>ggcoxzph()</code></p>
<pre class="r"><code>ggcoxzph(cox.zph(m2))</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Once again we can visualize our Cox PH model creating survival curves
for <em>particular groups of interest</em>. As before we specify the
groups in a new data frame. Below we specify two groups: a treated group
with median logwbc and placebo group with median logwbc. We then call
<code>ggsurvplot()</code> on the survfit object.</p>
<pre class="r"><code>nd &lt;- data.frame(rx = c(&quot;trt&quot;, &quot;placebo&quot;), logwbc = median(d$logwbc))
sfit2 &lt;- survfit(m2, newdata = nd)
ggsurvplot(sfit2, data = nd, conf.int = FALSE)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>We could also survival probabilities for the “trt” group with
different logwbc levels. Notice the <code>ggsurvplot()</code> offers a
<code>legend.labs</code> argument to change the legend labels. We set
the confident interval off for demo purposes, but setting it to TRUE
reveals the enormous uncertainty in these estimates.</p>
<pre class="r"><code>nd &lt;- data.frame(rx = &quot;trt&quot;, logwbc = c(2.5,3,3.5))
sfit3 &lt;- survfit(m2, newdata = nd)
ggsurvplot(sfit3, data = nd, conf.int = FALSE,
           legend.labs = paste(nd$rx, nd$logwbc))</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Let’s add the sex variable to our model. It is binary (1 = male, 0 =
female). Perhaps our analysis plan specified that we would adjust for
sex. This means retaining the sex variable regardless of significance.
Below the coefficient is slightly positive, suggesting a higher hazard
of failure for males. But the standard error is large and the z
statistic is small. We’re not sure what effect sex has on time to
failure. Nevertheless we opt to keep it in the model.</p>
<pre class="r"><code>m3 &lt;- coxph(Surv(survt, status) ~ rx + logwbc + sex, data = d)
summary(m3)</code></pre>
<pre><code>Call:
coxph(formula = Surv(survt, status) ~ rx + logwbc + sex, data = d)

  n= 42, number of events= 30 

            coef exp(coef) se(coef)     z Pr(&gt;|z|)    
rxplacebo 1.5036    4.4978   0.4615 3.258  0.00112 ** 
logwbc    1.6819    5.3760   0.3366 4.997 5.82e-07 ***
sex       0.3147    1.3698   0.4545 0.692  0.48872    
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

          exp(coef) exp(-coef) lower .95 upper .95
rxplacebo     4.498     0.2223    1.8204    11.113
logwbc        5.376     0.1860    2.7794    10.398
sex           1.370     0.7300    0.5621     3.338

Concordance= 0.851  (se = 0.041 )
Likelihood ratio test= 47.19  on 3 df,   p=3e-10
Wald test            = 33.54  on 3 df,   p=2e-07
Score (logrank) test = 48.01  on 3 df,   p=2e-10</code></pre>
<p>Now let’s assess the proportional hazards assumption for all
variables. The null is all variables satisfy the assumption. It appears
we have evidence against the null for the sex variable.</p>
<pre class="r"><code>cox.zph(m3, global = FALSE)</code></pre>
<pre><code>       chisq df    p
rx     0.036  1 0.85
logwbc 0.142  1 0.71
sex    5.420  1 0.02</code></pre>
<p>Likewise the plot shows a curvy line. We use <code>var = "sex"</code>
to see just the plot for sex.</p>
<pre class="r"><code>plot(cox.zph(m3), var = &quot;sex&quot;)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>One way to address a violation of the proportional hazards assumption
is with a <em>stratified Cox model</em>. The general idea is to group
the data according to the strata of a variable that violates the
assumption, fit a Cox PH model to each strata, and combine the results
into a single model. The coefficients of the remaining variables are
<em>assumed to be constant across strata</em>. We might think of them as
“pooled” estimates.</p>
<p>A drawback of this approach is the inability to examine the effects
of the stratifying variable. On the other hand, we may view it as a
unique feature that allows us to <em>adjust for variables that are not
modeled</em>. Stratification is most natural when a covariate takes on
only a few distinct values (like sex), and when the effect of the
stratifying variable is not of direct interest.</p>
<p>We can implement a stratified Cox model by wrapping the variable to
stratify on in the <code>strata()</code> function. Notice that sex is no
longer reported in the model. Since we stratified on it, we do not
estimate its effect. Also, the effects of rx and logwbc are assumed to
be the same for males and females. This is called the <em>no-interaction
assumption</em>.</p>
<pre class="r"><code>m4 &lt;- coxph(Surv(survt, status) ~ rx + logwbc + strata(sex), data = d)
summary(m4)</code></pre>
<pre><code>Call:
coxph(formula = Surv(survt, status) ~ rx + logwbc + strata(sex), 
    data = d)

  n= 42, number of events= 30 

            coef exp(coef) se(coef)     z Pr(&gt;|z|)    
rxplacebo 0.9981    2.7131   0.4736 2.108   0.0351 *  
logwbc    1.4537    4.2787   0.3441 4.225 2.39e-05 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

          exp(coef) exp(-coef) lower .95 upper .95
rxplacebo     2.713     0.3686     1.072     6.864
logwbc        4.279     0.2337     2.180     8.398

Concordance= 0.812  (se = 0.059 )
Likelihood ratio test= 32.06  on 2 df,   p=1e-07
Wald test            = 22.75  on 2 df,   p=1e-05
Score (logrank) test = 30.8  on 2 df,   p=2e-07</code></pre>
<p>We can test the no-interaction assumption by fitting a new model that
allows the stratification to interact with the other variables, and then
comparing this more complex model to the previous no-interaction model
using a likelihood ratio test via <code>anova()</code>. The null is no
difference in the models.</p>
<pre class="r"><code>m5 &lt;- coxph(Surv(survt, status) ~ (logwbc + rx) * strata(sex), 
            data = d)
summary(m5)</code></pre>
<pre><code>Call:
coxph(formula = Surv(survt, status) ~ (logwbc + rx) * strata(sex), 
    data = d)

  n= 42, number of events= 30 

                             coef exp(coef) se(coef)     z Pr(&gt;|z|)  
logwbc                     1.2061    3.3406   0.5035 2.396   0.0166 *
rxplacebo                  0.3113    1.3652   0.5636 0.552   0.5807  
logwbc:strata(sex)sex=1    0.5366    1.7102   0.7352 0.730   0.4655  
rxplacebo:strata(sex)sex=1 1.6666    5.2942   0.9295 1.793   0.0730 .
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

                           exp(coef) exp(-coef) lower .95 upper .95
logwbc                         3.341     0.2993    1.2452     8.962
rxplacebo                      1.365     0.7325    0.4524     4.120
logwbc:strata(sex)sex=1        1.710     0.5847    0.4048     7.226
rxplacebo:strata(sex)sex=1     5.294     0.1889    0.8562    32.735

Concordance= 0.797  (se = 0.058 )
Likelihood ratio test= 35.83  on 4 df,   p=3e-07
Wald test            = 21.69  on 4 df,   p=2e-04
Score (logrank) test = 33.15  on 4 df,   p=1e-06</code></pre>
<p>Compare the interaction model with the no-interaction model.</p>
<pre class="r"><code>anova(m4, m5)</code></pre>
<pre><code>Analysis of Deviance Table
 Cox model: response is  Surv(survt, status)
 Model 1: ~ rx + logwbc + strata(sex)
 Model 2: ~ (logwbc + rx) * strata(sex)
   loglik  Chisq Df Pr(&gt;|Chi|)
1 -55.735                     
2 -53.852 3.7659  2     0.1521</code></pre>
<p>It appears the simpler no-interaction model is sufficient.</p>
<p>Finally, we can re-check the proportional hazards assumption of the
stratified model.</p>
<pre class="r"><code>cox.zph(m4)</code></pre>
<pre><code>       chisq df    p
rx     0.148  1 0.70
logwbc 0.318  1 0.57
GLOBAL 0.478  2 0.79</code></pre>
<p>The stratified Cox PH model is commonly used in practice to adjust
for multiple sites in large clinical trials.</p>
<p>Again we can plot adjusted survival curves for the variables we
modeled. Below we create four adjusted survival curves with logwbc held
at the median value of 2.8.</p>
<ol style="list-style-type: decimal">
<li>Female, trt</li>
<li>Female, placebo</li>
<li>Male, trt</li>
<li>Male, placebo</li>
</ol>
<p>Notice we create the first plot for females by using the
<code>suvfit</code> indexing method. Rows 1 and 2 of the new data are
for females, so we select just those rows using
<code>sfit4[1:2]</code>.</p>
<pre class="r"><code>nd &lt;- expand.grid(rx = c(&quot;trt&quot;, &quot;placebo&quot;), sex = 0:1)
nd$logwbc &lt;- median(d$logwbc)
sfit4 &lt;- survfit(m4, newdata = nd)
ggsurvplot(sfit4[1:2], data = d, legend.labs = c(&quot;trt&quot;, &quot;placebo&quot;), 
           title = &quot;Female&quot;)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>And we can create a plot for males using <code>sfit4[3:4]</code></p>
<pre class="r"><code>ggsurvplot(sfit4[3:4], data = d, legend.labs = c(&quot;trt&quot;, &quot;placebo&quot;), 
           title = &quot;Male&quot;)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>When it comes to survival analysis, it’s important to check if any
subjects have high <em>leverage</em> or <em>influence</em>.</p>
<ul>
<li>Leverage: unusually large or small variables relative to rest of
data</li>
<li>Influence: removal would significantly change the model
coefficients</li>
</ul>
<p>High leverage itself is not necessarily a concern, however a subject
with leverage may influence the estimation of model coefficients.</p>
<p><em>Residuals</em> are central to model diagnostics. Residuals are
the difference between what we observe and what the model predicts.
However, “there is no obvious analog to the usual ‘observed minus
predicted’ residual used with other regression methods.” (Hosmer et al,
p. 170) Recall that we deal with censored observations (i.e,, no
observed value). This complicates matters. Instead, different types of
residuals have been developed based on martingale theory. The math
behind these residuals is difficult and we will take it on faith that it
works.</p>
<p>To assess leverage, we can use <em>score residuals</em>. Each subject
in a Cox PH model will have a <em>separate score residual for each
variable</em> in the model. The larger a score residual for a particular
variable (in absolute value), the larger the “leverage”.</p>
<p>We can extract score residuals using the <code>residual()</code>
function with <code>type = score</code>. Below we request score
residuals for model m4. Notice there is a <em>separate residual</em> for
each variable in the model.</p>
<pre class="r"><code>r &lt;- residuals(m4, type = &quot;score&quot;)
head(r)</code></pre>
<pre><code>   rxplacebo      logwbc
1 0.05268608  0.20516809
2 0.05424031  0.20713737
3 0.15674055  0.16790181
4 0.25322991 -0.04327465
5 0.08511958  0.22574242
6 0.02729922  0.35266769</code></pre>
<p>For continuous variables, we can plot the score residual versus the
variable. Below we check the logwbc residuals. We appear to have four
subjects with unusually large residuals (in absolute value).</p>
<pre class="r"><code>plot(r[,&quot;logwbc&quot;] ~ d$logwbc)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>For categorical variables, we can create boxplots of the score
residuals versus the variable. Again we have a few outlying subjects we
should investigate.</p>
<pre class="r"><code>boxplot(r[,&quot;rxplacebo&quot;] ~ d$rx)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>For logwbc, we could check which subjects have a score residual less
than -0.5</p>
<pre class="r"><code>i &lt;- which(r[,&quot;logwbc&quot;] &lt; -1) # select rows
i</code></pre>
<pre><code>19 26 37 41 
19 26 37 41 </code></pre>
<p>Likewise we can check the rx score residuals.</p>
<pre class="r"><code>j &lt;- which(r[,&quot;rxplacebo&quot;] &lt; -0.4)
j</code></pre>
<pre><code>15 19 21 
15 19 21 </code></pre>
<p>Subject 19 appears in both results. We can inspect the records for
these subjects as follows. The <code>union()</code> function basically
prevents subject 19 from appearing twice below.</p>
<pre class="r"><code>d[union(i,j),]</code></pre>
<pre><code>   survt status sex logwbc      rx
19     6      1   0   2.31     trt
26    12      1   0   1.50 placebo
37     4      1   1   2.42 placebo
41     1      1   1   2.80 placebo
15    10      1   0   2.96     trt
21     6      1   0   3.28     trt</code></pre>
<p>Subject 19 appears to stand out by being in the treatment group but
experiencing “failure” at only 6 weeks.</p>
<p>To assess influence, we can use <em>scaled score residuals</em>, also
known as “dfbetas”. Each subject in a Cox PH model will have a
<em>separate dfbeta for each variable</em> in the model. The larger a
dfbeta for a particular variable (in absolute value), the larger the
“influence”.</p>
<p>We can extract score residuals using the <code>residual()</code>
function with <code>type = "dfbeta"</code>. Below we request dfbetas for
model m4. Again, notice there is a separate residual for each variable
in the model.</p>
<pre class="r"><code>r2 &lt;- residuals(m4, type = &quot;dfbeta&quot;)
head(r2)</code></pre>
<pre><code>         [,1]         [,2]
1 0.010989342  0.024076432
2 0.011329959  0.024303307
3 0.034473951  0.019245951
4 0.056961970 -0.006142143
5 0.018179881  0.026381557
6 0.004702614  0.041640090</code></pre>
<p>These residuals are simply the score residuals multiplied by the
model covariance matrix, which can be obtained with the function
<code>vcov()</code>.</p>
<pre class="r"><code># Use %*% for matrix multiplication
head(residuals(m4, type = &quot;score&quot;) %*% vcov(m4)) </code></pre>
<pre><code>    rxplacebo       logwbc
1 0.010989342  0.024076432
2 0.011329959  0.024303307
3 0.034473951  0.019245951
4 0.056961970 -0.006142143
5 0.018179881  0.026381557
6 0.004702614  0.041640090</code></pre>
<p>Again we can use scatter plots and box plots to investigate
influence.</p>
<pre class="r"><code>plot(r2[,2] ~ d$logwbc)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>The same four subjects seem to stand out:</p>
<pre class="r"><code>which(r2[,2] &lt; -0.1)</code></pre>
<pre><code>19 26 37 41 
19 26 37 41 </code></pre>
<pre class="r"><code>boxplot(r2[,1] ~ d$rx)</code></pre>
<p><img src="survival_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>And the same three subjects appear to have outlying dfbeta values for
rx.</p>
<pre class="r"><code>which(r2[,1] &lt; -0.1)</code></pre>
<pre><code>15 19 21 
15 19 21 </code></pre>
<p>Once again subject 19 appears in both residual sets as having a large
residual relative to the rest of the data.</p>
<p>To find out how variables are influencing a model, we need to drop
them and refit the model. With such a small data set, we would want to
think carefully before permanently dropping subjects. However, let’s say
we want to see how much subject 19 is influencing the model. We can
refit the model without subject 19 and calculate the change in the rx
coefficient.</p>
<pre class="r"><code>m4a &lt;- coxph(Surv(survt, status) ~ rx + logwbc + strata(sex), 
             data = d[-19,])
coef(m4a)[&quot;rxplacebo&quot;]/coef(m4)[&quot;rxplacebo&quot;]</code></pre>
<pre><code>rxplacebo 
 1.146543 </code></pre>
<p>With subject 19 removed from the model, the coefficient estimate for
rx increases by almost 15%, which makes the treatment look even better.
This doesn’t mean we should drop the subject. It just helps us
understand the impact a single subject has on our model. The decision to
drop subjects should be carefully considered and not made based on just
residual values.</p>
<div id="refs" class="references csl-bib-body hanging-indent"
entry-spacing="0">
<div id="ref-blood" class="csl-entry">
B, ACUTE LEUKEMIA GROUP, EMIL J FREIREICH, EDMUND GEHAN, III FREI EMIL,
LESLIE R. SCHROEDER, IRVING J. WOLMAN, RACHAD ANBARI, et al. 1963.
<span>“<span class="nocase">The Effect of 6-Mercaptopurine on the
Duration of Steroid-induced Remissions in Acute Leukemia: A Model for
Evaluation of Other Potentially Useful Therapy</span>.”</span>
<em>Blood</em> 21 (6): 699–716. <a
href="https://doi.org/10.1182/blood.V21.6.699.699">https://doi.org/10.1182/blood.V21.6.699.699</a>.
</div>
<div id="ref-kleinbaum" class="csl-entry">
David G. Kleinbaum, Mitchel Klein. 2005. <em>Survival Analysis, a
Self-Learning Text, Second Edition</em>. Springer.
</div>
<div id="ref-hosmer2008" class="csl-entry">
David W. Hosmer, Susanne May, Stanley Lemeshow. 2008. <em>Applied
Survival Analysis: Regression Modeling of Time to Event Data: Second
Edition</em>. John Wiley; Sons Inc.
</div>
<div id="ref-survminer" class="csl-entry">
Kassambara, Alboukadel, Marcin Kosinski, and Przemyslaw Biecek. 2021.
<em>Survminer: Drawing Survival Curves Using ’Ggplot2’</em>. <a
href="https://CRAN.R-project.org/package=survminer">https://CRAN.R-project.org/package=survminer</a>.
</div>
<div id="ref-survival-package" class="csl-entry">
Therneau, Terry M. 2024. <em>A Package for Survival Analysis in r</em>.
<a
href="https://CRAN.R-project.org/package=survival">https://CRAN.R-project.org/package=survival</a>.
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
